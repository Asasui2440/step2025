# 第3回 Calculator  

### **概要**

四則演算や括弧、さらに abs、round、int 関数を含む数式を解析し、計算を行う電卓プログラム
入力された数式をtoken化し、適切な順序で評価することで結果を計算する


## **機能一覧**

1. **token化**  
数式を読み取り、数字や演算子、括弧、関数をtokenとして分割する
      
3. **関数の評価**  
abs、round、int 関数を評価し、結果をtokenのリストに反映
      
4. **括弧の評価**  
括弧内の式を優先的に計算
      
5. **演算の評価**  
掛け算 (*) と割り算 (`/`) を優先的に計算し、その後足し算 (`+`) と引き算 (-) を計算
      
6. **テスト機能**  
事前に定義された数式をテストし、正しい結果が得られるか確認
      
7. **対話型電卓**  
ユーザーが数式を入力すると、その結果を計算して表示する



## **コードの構造**

### **1. Token化**

### 演算子読み取り関数  
- tokenとindexを返す  
`read_plus(), read_minus(), read_times(), read_divide()`: **基本演算子**   
`read_kakko_left(), read_kakko_right()`: **括弧**  
`read_abs(), read_round(), read_int()`: **関数名**  


### **関数: tokenize(line)**

- 入力された数式を読み取り、tokenのリストを生成する


- tokenには以下の種類があります：

  
    - **数字 (`NUMBER`)**:    `{"type": "NUMBER", "number": number}`
    - **足し算 (`PLUS`)**:     `{"type": "PLUS"}`
    - **引き算 (`MINUS`)**     `{"type": "MINUS"}`
    - **掛け算 (`TIMES`)**     ` {"type": "TIMES"}`
    - **割り算 (`DIVIDE`)**     `{"type": "DIVIDE"}`
    - **左括弧 (`KAKKO_LEFT`)**    `{"type": "KAKKO_LEFT"}`
    - **右括弧 (`KAKKO_RIGHT`)**    `{"type": "KAKKO_RIGHT"}`
    - **関数 (`ABS`, `ROUND`, `INT`)**    `{"type": "ABS"}`,`{"type": "ROUND"}`,`{"type": "INT"}`
 
  

---

### **2. 関数の評価**

### **関数: evaluate_options(tokens)**

- abs、round、int 関数を評価
- 関数の後に続く数字を計算し、その結果をtokenのリストに反映する

---

### **3. 括弧の評価**

### **関数: evaluate_kakko(tokens)**

- 括弧内の式を優先的に計算
- 括弧の右側 (`KAKKO_RIGHT`) を見つけたら、対応する左括弧 (`KAKKO_LEFT`) を探し、その間の式を計算する

---

### **4. 演算の評価**

### **関数: evaluate_times_divide(tokens)**

- 掛け算 () と割り算 (`/`) を優先的に計算
- 数字と演算子を組み合わせて計算し、結果をtokenのリストに反映します。

### **関数: evaluate(tokens)**

- 括弧、関数、掛け算・割り算を評価した後、足し算 (`+`) と引き算 () を計算

---

### **5. テスト機能**

### **関数: test(line)**

- 数式を入力し、プログラムの計算結果と Python の eval 関数の結果を比較する
- 結果が一致すれば `PASS`、一致しなければ `FAIL` を表示

### **関数: run_test()**

- 複数のテストケースを実行し、プログラムの動作を確認

---

### **6. 対話型電卓**

### **対話型処理**

- ユーザーが数式を入力すると、token化・評価を行い、結果を表示します。

---

## **使用例**

### **テストの実行**

`python calculator.py`

出力例：
```
==== Test started! ====

PASS! (1+2 = 3.000000)

PASS! (1.0+(2.1-3 )= 0.100000)

PASS! (1+2*3 = 7.000000)

PASS! (1+2/3 = 1.666667)

PASS! (abs(-2) = 2.000000)

PASS! (round(2.6) = 3.000000)

PASS! (int(2.2) = 2.000000)

==== Test finished! ====
```

### **対話型電卓の使用**
```
> 1+2*3

answer = 7.000000

> abs(-5) + round(2.7)

answer = 8.000000
```
---

## **注意事項**

1. **無効な入力**
    - 無効な文字や構文が含まれる場合、エラーメッセージを表示して終了する
2. **計算精度**
    - 小数点以下の計算精度は `1e-8` で比較
3. **括弧のネスト**
    - ネストされた括弧も正しく処理できる。

---

##
