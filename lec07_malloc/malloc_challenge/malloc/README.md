# 第7回  Malloc challenge 

**メモリ効率が良く、処理速度の速いmallocを実装する**    
- 詳細  https://github.com/hikalium/malloc_challenge/tree/main


## Files

- `simple_malloc.c`   
  デフォルトのプログラム。最初に見つけた空き領域にデータを格納する

- `malloc.c`  
  best fit + left/right merged  
  メモリを解放しようとする領域の両側が空き領域だった場合に結合する

- `listbin.c`    
  best_fit + list bin  
  binを13個作成し、データサイズによって使うbinを選択する。要求されるデータのサイズの分布も出してみた  
  

- `worst_fit_malloc.c`    
  メモリ効率を最も悪くする  
  格納したいデータのサイズ以上の空き領域の中で最も大きい空き領域を選ぶ


## 実行結果

**Time(ms) / Utilization(%)**   
| 実装ファイル        | Challenge 1      | Challenge 2      | Challenge 3      | Challenge 4       | Challenge 5       |
|------------------------|------------------|------------------|------------------|-------------------|-------------------|
| simple_malloc.c        | 8ms / 70%        | 4ms / 40%        | 74ms / 9%        | 10541ms / 15%     | 6197ms / 15%      |
| malloc.c               | 747ms / 70%      | 322ms / 40%      | 392ms / 51%      | 2659ms / **76%**      | 1410ms / **79%**      |
| best_fitのみ          | 1185ms / 70%     | 398ms / 40%     | 591ms / 50%     | 5493ms / 72%      | 3604ms / 75%      |
| listbin.c           | 779ms / 70%     | 642ms / 40%     | 134ms / 51%     | 324ms / 72%      | 235ms / 75%      |
| worst_fit_malloc.c     | 924ms / 70%      | 667ms / 40%      | 42131ms / 4%     | 671779ms / 7%     | 750911ms / 7%     |


## 考察
- 両側結合したことによって、Utilizationが向上した。
- best_fitのみと、両側結合+best_fitでは、両側結合によって空き領域が増えたことで、要求データ以上の空き領域を見つけやすくなり、追加しなければならない空き領域が減ったため探索時間が減ったと考えた。
- listbinでは大幅にtimeが向上した。challengeでサイズの分布がバラけているほど速いはず。 
- worst fitでは実行時間がとても長くなった。Utilizationも1桁%になった。
- 新たなデータ領域を増やさないといけなくなり、領域がどんどん増えていって全探索していく時間が長くなっていくためだと考えた。

## Challengeごとの要求データサイズ分布
- objectのサイズは(8の倍数)バイトで、8<=size<=4000です。 
- byteはちょうどその値ではなく、◻︎◻︎byteより大きく、〇〇byte以下と言う意味です   
- challengeごとのリクエスト数は同じな気がします。若干異なっていますが、リクエスト数はmy_mallocが呼ばれた回数をカウントしてるので、空き領域を増やした時に再帰呼び出しの分もカウントされているからな気がします。  


| Challenge | サイズ区分     | リクエスト数 | 割合     |
|-----------|----------------|--------------|----------|
| #1        | 128 bytes      | 119,283      | 100.0%   |
| #2        | 16 bytes       | 119,062      | 100.0%   |

| Challenge | サイズ区分     | リクエスト数 | 割合     |
|-----------|----------------|--------------|----------|
| #3        | 16 bytes       | 41,666       | 35.0%    |
|           | 24 bytes       | 27,067       | 22.7%    |
|           | 32 bytes       | 17,537       | 14.7%    |
|           | 48 bytes       | 18,897       | 15.9%    |
|           | 64 bytes       | 7,946        | 6.7%     |
|           | 96 bytes       | 4,891        | 4.1%     |
|           | 128 bytes      | 1,089        | 0.9%     |


| Challenge | サイズ区分     | リクエスト数 | 割合     |
|-----------|----------------|--------------|----------|
| #4        | 256 bytes      | 1,551        | 1.3%     |
|           | 512 bytes      | 39,748       | 32.9%    |
|           | 1K bytes       | 44,233       | 36.6%    |
|           | 2K bytes       | 28,229       | 23.4%    |
|           | >2K bytes      | 7,111        | 5.9%     |

| Challenge | サイズ区分     | リクエスト数 | 割合     |
|-----------|----------------|--------------|----------|
| #5        | ≤64 bytes      | 11,009       | 9.1%     |
|           | 96 bytes       | 5,220        | 4.3%     |
|           | 128 bytes      | 4,773        | 4.0%     |
|           | 256 bytes      | 17,068       | 14.2%    |
|           | 512 bytes      | 26,062       | 21.6%    |
|           | 1K bytes       | 29,845       | 24.8%    |
|           | 2K bytes       | 20,440       | 17.0%    |
|           | >2K bytes      | 5,972        | 5.0%     |



  
  
